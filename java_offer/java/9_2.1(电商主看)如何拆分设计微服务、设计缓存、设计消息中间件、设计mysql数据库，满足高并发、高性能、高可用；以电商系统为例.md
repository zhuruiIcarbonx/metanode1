## MySQL MHA


    MySQL MHA (Master High Availability) æ˜¯ä¸€ä¸ªå¼€æºçš„é«˜å¯ç”¨æ€§è§£å†³æ–¹æ¡ˆï¼Œ
	ç”¨äºåœ¨ MySQL ä¸»ä»å¤åˆ¶æ¶æ„ä¸­æä¾›è‡ªåŠ¨åŒ–çš„ä¸»åº“æ•…éšœè½¬ç§»å’Œæ•°æ®ä¸€è‡´æ€§ä¿éšœã€‚
	å½“ä¸»åº“å‘ç”Ÿæ•…éšœæ—¶ï¼ŒMHA å¯ä»¥åœ¨æçŸ­çš„æ—¶é—´å†…ï¼ˆé€šå¸¸ 0-30 ç§’ï¼‰è‡ªåŠ¨å°†ä¸€ä¸ªæ•°æ®æœ€å®Œæ•´çš„ä»åº“æå‡ä¸ºæ–°çš„ä¸»åº“ï¼Œ
	å¹¶å°†å…¶ä»–ä»åº“é‡æ–°æŒ‡å‘æ–°çš„ä¸»åº“ï¼Œä»¥ä¿è¯æ•°æ®åº“æœåŠ¡çš„è¿ç»­æ€§ã€‚ 
**ä¸»è¦ç»„æˆéƒ¨åˆ†**
<br>



    MHA Manager (ç®¡ç†èŠ‚ç‚¹): éƒ¨ç½²åœ¨ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šï¼Œè´Ÿè´£ç›‘æ§é›†ç¾¤çŠ¶æ€ã€æ£€æµ‹ä¸»åº“æ•…éšœå¹¶æ‰§è¡Œåˆ‡æ¢æ“ä½œã€‚
    MHA Node (æ•°æ®èŠ‚ç‚¹): è¿è¡Œåœ¨æ¯å° MySQL æœåŠ¡å™¨ä¸Šï¼Œè´Ÿè´£ä¿å­˜å’ŒåŒæ­¥ binlog æ—¥å¿—ï¼Œå¹¶åœ¨æ•…éšœè½¬ç§»æ—¶ä¿®å¤ä»åº“ä¹‹é—´çš„å·®å¼‚ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€‚ 

**å·¥ä½œåŸç†**
<br>



    **ç›‘æ§**: MHA Manager æŒç»­ç›‘æ§ä¸»ä»å¤åˆ¶é›†ç¾¤ä¸­çš„èŠ‚ç‚¹çŠ¶æ€ã€‚
    **æ•…éšœæ£€æµ‹**: å½“ MHA Manager è¿ç»­å¤šæ¬¡æ— æ³•è¿æ¥åˆ°ä¸»åº“æ—¶ï¼Œä¼šåˆ¤å®šä¸»åº“å‘ç”Ÿæ•…éšœã€‚
    **æ•…éšœè½¬ç§»**:
    MHA ä¼šå°è¯•ä»åŸä¸»åº“ä¿å­˜æœªåŒæ­¥çš„ binlogã€‚
    åœ¨ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªæ‹¥æœ‰æœ€æ–°æ•°æ®çš„èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»åº“ã€‚
    MHA ä¼šå°†åŸä¸»åº“çš„ binlog åŒæ­¥åˆ°æ–°ä¸»åº“ã€‚
    ç„¶åï¼ŒMHA ä¼šå°†å…¶ä»–ä»åº“çš„å¤åˆ¶æºæ›´æ”¹ä¸ºæ–°ä¸»åº“ã€‚
    åœ¨çº¿åˆ‡æ¢: é™¤äº†è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ŒMHA è¿˜æ”¯æŒæŒ‰éœ€è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚ 

**ä¸»è¦ä¼˜åŠ¿**
<br>



    **è‡ªåŠ¨åŒ–**: èƒ½å¤Ÿè‡ªåŠ¨å®Œæˆæ•…éšœæ£€æµ‹å’Œåˆ‡æ¢ï¼Œå‡å°‘äººå·¥å¹²é¢„ã€‚
    **å¿«é€Ÿåˆ‡æ¢**: å¯ä»¥åœ¨ 0-30 ç§’å†…å®Œæˆæ•…éšœè½¬ç§»ï¼Œæ˜¾è‘—å‡å°‘æœåŠ¡ä¸­æ–­æ—¶é—´ã€‚
    **æ•°æ®ä¸€è‡´æ€§**: é€šè¿‡ä¿®å¤ä»åº“ä¹‹é—´çš„å·®å¼‚æ—¥å¿—ï¼Œæœ€å¤§ç¨‹åº¦åœ°ä¿è¯æ‰€æœ‰ä»åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚
    **é€æ˜æ€§**: æ•´ä¸ªæ•…éšœè½¬ç§»è¿‡ç¨‹å¯¹åº”ç”¨ç¨‹åºæ˜¯é€æ˜çš„ï¼Œä¸å½±å“ç°æœ‰åº”ç”¨
	
<br>


# ä¸€ã€(ç»†è¯»)å¦‚ä½•æ‹†åˆ†è®¾è®¡å¾®æœåŠ¡ã€è®¾è®¡ç¼“å­˜ã€è®¾è®¡æ¶ˆæ¯ä¸­é—´ä»¶ã€è®¾è®¡mysqlæ•°æ®åº“ï¼Œæ»¡è¶³é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨ï¼›ä»¥ç”µå•†ç³»ç»Ÿä¸ºä¾‹

åœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œé¢å¯¹**é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨**ï¼ˆ3Hï¼‰çš„æŒ‘æˆ˜ï¼Œå¿…é¡»ä» **å¾®æœåŠ¡æ‹†åˆ†ã€ç¼“å­˜è®¾è®¡ã€æ¶ˆæ¯ä¸­é—´ä»¶ã€MySQL æ•°æ®åº“æ¶æ„** å››ä¸ªæ ¸å¿ƒç»´åº¦è¿›è¡Œç³»ç»Ÿæ€§è®¾è®¡ã€‚ä»¥ä¸‹ä»¥å…¸å‹ç”µå•†ç³»ç»Ÿï¼ˆå¦‚äº¬ä¸œã€æ·˜å®çº§åˆ«ï¼‰ä¸ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜å¦‚ä½•æ„å»ºä¸€ä¸ªæ”¯æ’‘åƒä¸‡çº§ç”¨æˆ·ã€ç™¾ä¸‡çº§ QPS çš„ç°ä»£åŒ–ç”µå•†æ¶æ„ã€‚

---

## ä¸€ã€å¾®æœåŠ¡æ‹†åˆ†è®¾è®¡ï¼ˆMicroservices Architectureï¼‰

### âœ… æ‹†åˆ†åŸåˆ™
- **é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰**ï¼šæŒ‰ä¸šåŠ¡è¾¹ç•Œåˆ’åˆ†æœåŠ¡
- **é«˜å†…èšã€ä½è€¦åˆ**ï¼šæ¯ä¸ªæœåŠ¡èŒè´£å•ä¸€
- **æ•°æ®è‡ªæ²»**ï¼šæ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹æ•°æ®åº“
- **å¯ç‹¬ç«‹éƒ¨ç½²ä¸å¼¹æ€§ä¼¸ç¼©**

### âœ… ç”µå•†ç³»ç»Ÿå…¸å‹å¾®æœåŠ¡æ‹†åˆ†

| å¾®æœåŠ¡ | èŒè´£ | å…³é”®èƒ½åŠ› |
|--------|------|----------|
| **ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰** | æ³¨å†Œã€ç™»å½•ã€æƒé™ã€ä¸ªäººä¿¡æ¯ | JWT/OAuth2ã€Redis ç¼“å­˜ä¼šè¯ |
| **å•†å“æœåŠ¡ï¼ˆProduct Serviceï¼‰** | å•†å“ä¿¡æ¯ã€åˆ†ç±»ã€å“ç‰Œã€ä¸Šä¸‹æ¶ | Elasticsearch æ”¯æŒæœç´¢ |
| **åº“å­˜æœåŠ¡ï¼ˆInventory Serviceï¼‰** | åº“å­˜æŸ¥è¯¢ã€æ‰£å‡ã€å›æ»šã€é¢„è­¦ | åˆ†å¸ƒå¼é”ã€Redis åŸå­æ“ä½œ |
| **è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰** | åˆ›å»ºè®¢å•ã€çŠ¶æ€ç®¡ç†ã€æŸ¥è¯¢ | åˆ†åº“åˆ†è¡¨ã€å¹‚ç­‰æ§åˆ¶ |
| **æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰** | æ”¯ä»˜è¯·æ±‚ã€å›è°ƒã€å¯¹è´¦ | ç¬¬ä¸‰æ–¹æ”¯ä»˜å¯¹æ¥ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰ |
| **è´­ç‰©è½¦æœåŠ¡ï¼ˆCart Serviceï¼‰** | æ·»åŠ å•†å“ã€ä¿®æ”¹æ•°é‡ã€åˆ é™¤ | Redis å­˜å‚¨ï¼ˆé«˜æ€§èƒ½è¯»å†™ï¼‰ |
| **ä¼˜æƒ åˆ¸/ä¿ƒé”€æœåŠ¡ï¼ˆPromotion Serviceï¼‰** | ä¼˜æƒ åˆ¸å‘æ”¾ã€ä½¿ç”¨ã€æ»¡å‡è§„åˆ™ | é™æµé˜²åˆ·ã€åº“å­˜é¢„å  |
| **ç‰©æµæœåŠ¡ï¼ˆLogistics Serviceï¼‰** | å‘è´§ã€ç‰©æµè·Ÿè¸ªã€ç­¾æ”¶ | å¯¹æ¥å¿«é€’100ç­‰API |
| **æœç´¢æœåŠ¡ï¼ˆSearch Serviceï¼‰** | å•†å“å…¨æ–‡æ£€ç´¢ã€ç­›é€‰ã€æ’åº | Elasticsearch + RabbitMQ åŒæ­¥ |
| **é€šçŸ¥æœåŠ¡ï¼ˆNotification Serviceï¼‰** | çŸ­ä¿¡ã€é‚®ä»¶ã€ç«™å†…ä¿¡ | å¼‚æ­¥å‘é€ï¼Œæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦ |
| **é…ç½®ä¸­å¿ƒï¼ˆConfig Serviceï¼‰** | ç»Ÿä¸€é…ç½®ç®¡ç† | Nacos / Apollo |
| **API ç½‘å…³ï¼ˆGateway Serviceï¼‰** | è·¯ç”±ã€é‰´æƒã€é™æµã€ç†”æ–­ | Spring Cloud Gateway / Kong |

> âœ… ç¤ºä¾‹ï¼šä¸‹å•æµç¨‹æ¶‰åŠå¤šä¸ªæœåŠ¡ååŒï¼š
```
ç”¨æˆ· â†’ ç½‘å…³ â†’ è®¢å•æœåŠ¡ â†’ åº“å­˜æœåŠ¡ï¼ˆæ‰£åº“å­˜ï¼‰â†’ æ”¯ä»˜æœåŠ¡ï¼ˆå‘èµ·æ”¯ä»˜ï¼‰â†’ ç‰©æµæœåŠ¡ï¼ˆå‘è´§ï¼‰
```

---

## äºŒã€ç¼“å­˜è®¾è®¡ï¼ˆCache Designï¼‰

ç¼“å­˜æ˜¯ç”µå•†ç³»ç»Ÿæ€§èƒ½çš„æ ¸å¿ƒä¿éšœï¼Œç”¨äºåŠ é€Ÿè¯»å–ã€å‡å°‘æ•°æ®åº“å‹åŠ›ã€‚

### âœ… ç¼“å­˜ä½¿ç”¨åœºæ™¯ä¸ç­–ç•¥

| åœºæ™¯ | ç¼“å­˜æ–¹æ¡ˆ | è¯´æ˜ |
|------|----------|------|
| **å•†å“ä¿¡æ¯** | Redis String / Hash | TTL ç¼“å­˜ï¼Œçƒ­ç‚¹å•†å“é¢„çƒ­ |
| **åº“å­˜** | Redis + DB åŒå†™ | æ‰£å‡ç”¨ Lua è„šæœ¬ä¿è¯åŸå­æ€§ |
| **è´­ç‰©è½¦** | Redis Hash | `HSET cart:uid pid count` |
| **ä¼šè¯ï¼ˆSessionï¼‰** | Redis | æ”¯æŒé›†ç¾¤ç™»å½• |
| **ç”¨æˆ·ä¿¡æ¯** | Redis | å‡å°‘ç”¨æˆ·æœåŠ¡è°ƒç”¨ |
| **ç§’æ€åº“å­˜** | Redis é¢„å‡åº“å­˜ | é˜²æ­¢è¶…å–ï¼Œé…åˆæ¶ˆæ¯é˜Ÿåˆ— |
| **æ¨èå•†å“** | Redis ZSet | æŒ‰çƒ­åº¦æ’åº |
| **åˆ†å¸ƒå¼é”** | Redis SETNX / Redlock | æ‰£åº“å­˜ã€åˆ›å»ºè®¢å•æ—¶ä½¿ç”¨ |

### âœ… ç¼“å­˜é«˜å¯ç”¨è®¾è®¡
- ä½¿ç”¨ **Redis Cluster** å®ç°æ•°æ®åˆ†ç‰‡ä¸æ•…éšœè½¬ç§»
- å¼€å¯ **æŒä¹…åŒ–ï¼ˆAOF + RDBï¼‰** é˜²æ­¢é‡å¯ä¸¢æ•°æ®
- è®¾ç½®åˆç† **TTL**ï¼Œé¿å…å†…å­˜çˆ†ç‚¸
- **ç¼“å­˜ç©¿é€**ï¼šå¸ƒéš†è¿‡æ»¤å™¨ + ç©ºå€¼ç¼“å­˜
- **ç¼“å­˜å‡»ç©¿**ï¼šçƒ­ç‚¹ key åŠ äº’æ–¥é”
- **ç¼“å­˜é›ªå´©**ï¼šéšæœºè¿‡æœŸæ—¶é—´ + å¤šçº§ç¼“å­˜ï¼ˆæœ¬åœ° + Redisï¼‰

---

## ä¸‰ã€æ¶ˆæ¯ä¸­é—´ä»¶è®¾è®¡ï¼ˆMessage Queueï¼‰

æ¶ˆæ¯é˜Ÿåˆ—ç”¨äº**è§£è€¦ã€å¼‚æ­¥ã€å‰Šå³°ã€æœ€ç»ˆä¸€è‡´æ€§**ï¼Œæ˜¯ç”µå•†ç³»ç»Ÿçš„â€œä¸­æ¢ç¥ç»â€ã€‚

### âœ… ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | MQ ä½œç”¨ |
|------|--------|
| **å¼‚æ­¥ä¸‹å•** | ä¸‹å•æˆåŠŸåï¼Œå¼‚æ­¥æ‰£åº“å­˜ã€å‘ä¼˜æƒ åˆ¸ã€é€šçŸ¥ç‰©æµ |
| **è®¢å•çŠ¶æ€å˜æ›´** | è®¢å•å…³é—­ã€æ”¯ä»˜æˆåŠŸç­‰äº‹ä»¶å¹¿æ’­ |
| **æ—¥å¿—æ”¶é›†** | æ“ä½œæ—¥å¿—ã€äº¤æ˜“æ—¥å¿—å¼‚æ­¥å†™å…¥ Kafka + ELK |
| **åº“å­˜å›æ»š** | æ”¯ä»˜è¶…æ—¶ â†’ æ¶ˆæ¯è§¦å‘åº“å­˜å›æ»š |
| **æ•°æ®åŒæ­¥** | å•†å“å˜æ›´ â†’ åŒæ­¥åˆ°æœç´¢ã€æ¨èç³»ç»Ÿ |

### âœ… æ¶ˆæ¯ä¸­é—´ä»¶é€‰å‹å¯¹æ¯”

| ä¸­é—´ä»¶ | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|--------|----------|------|------|
| **RocketMQ** | é‡‘èçº§å¯é æ¶ˆæ¯ | äº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ã€ä½å»¶è¿Ÿ | è¿ç»´å¤æ‚ |
| **Kafka** | é«˜ååã€æ—¥å¿—ç±» | ç™¾ä¸‡çº§ QPSï¼ŒæŒä¹…åŒ–å¥½ | å»¶è¿Ÿç•¥é«˜ |
| **RabbitMQ** | ä¸­å°è§„æ¨¡ã€çµæ´»è·¯ç”± | æ˜“ç”¨ã€æ’ä»¶ä¸°å¯Œ | ååé‡è¾ƒä½ |

> âœ… **æ¨èï¼šRocketMQ**ï¼ˆæ”¯æŒäº‹åŠ¡æ¶ˆæ¯ã€é¡ºåºæ¶ˆæ¯ã€é«˜ååï¼‰

### âœ… æ¶ˆæ¯å¯é æ€§ä¿éšœ

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| **æ¶ˆæ¯ä¸¢å¤±** | ç”Ÿäº§è€… ACK + Broker æŒä¹…åŒ– + æ¶ˆè´¹è€…æ‰‹åŠ¨ ACK |
| **é‡å¤æ¶ˆè´¹** | æ¶ˆè´¹ç«¯å¹‚ç­‰ï¼ˆå¦‚ `order_id` å»é‡è¡¨ï¼‰ |
| **é¡ºåºæ¶ˆæ¯** | ä½¿ç”¨ RocketMQ é¡ºåºæ¶ˆæ¯ï¼ˆåŒä¸€è®¢å• ID åˆ†åˆ°åŒä¸€é˜Ÿåˆ—ï¼‰ |
| **æ¶ˆæ¯ç§¯å‹** | æ‰©å®¹æ¶ˆè´¹è€… + æ‰¹é‡æ¶ˆè´¹ + æ­»ä¿¡é˜Ÿåˆ— |

---

## å››ã€MySQL æ•°æ®åº“è®¾è®¡ï¼ˆæ»¡è¶³ 3Hï¼‰

### âœ… 1. æ•°æ®åº“å‚ç›´æ‹†åˆ†ï¼ˆæŒ‰æœåŠ¡åˆ†åº“ï¼‰

| æœåŠ¡ | æ•°æ®åº“ |
|------|--------|
| ç”¨æˆ·æœåŠ¡ | `db_user` |
| å•†å“æœåŠ¡ | `db_product` |
| è®¢å•æœåŠ¡ | `db_order` |
| åº“å­˜æœåŠ¡ | `db_inventory` |
| æ”¯ä»˜æœåŠ¡ | `db_payment` |
| ä¿ƒé”€æœåŠ¡ | `db_promotion` |

> âœ… é¿å…è·¨åº“ JOINï¼ŒæœåŠ¡é—´é€šè¿‡ API è°ƒç”¨è·å–æ•°æ®

---

### âœ… 2. æ•°æ®åº“æ°´å¹³æ‹†åˆ†ï¼ˆåˆ†åº“åˆ†è¡¨ï¼‰

#### å…¸å‹å¤§è¡¨ï¼šè®¢å•è¡¨ `t_order`

- å•è¡¨æ•°æ®é‡å¤§ï¼ˆäº¿çº§ï¼‰
- å†™å¤šè¯»å°‘ï¼ŒæŸ¥è¯¢å¤šæŒ‰ `user_id`ã€`order_no`ã€`create_time`

#### åˆ†åº“åˆ†è¡¨ç­–ç•¥

| ç­–ç•¥ | è¯´æ˜ | æ¨è |
|------|------|
| **æŒ‰ç”¨æˆ· ID å“ˆå¸Œ** | `user_id % 1024` â†’ åˆ† 1024 å¼ è¡¨ | æŸ¥è¯¢ç”¨æˆ·è®¢å•å¿« |
| **æŒ‰è®¢å•å·åˆ†ç‰‡** | è®¢å•å·åŒ…å«åˆ†ç‰‡ä½ï¼ˆå¦‚ `202511070001_03`ï¼‰ | è·¯ç”±æ˜ç¡® |
| **æ—¶é—´åˆ†ç‰‡** | æŒ‰æœˆå»ºè¡¨ï¼ˆ`t_order_202511`ï¼‰ | ä¾¿äºå½’æ¡£ |

> âœ… æ¨èç»„åˆç­–ç•¥ï¼š
- å…ˆæŒ‰ `user_id % 64` åˆ†åº“
- å†æŒ‰ `create_time` åˆ†è¡¨ï¼ˆæ¯æœˆä¸€å¼ ï¼‰

#### å·¥å…·æ”¯æŒ
- **Apache ShardingSphere**ï¼šæ”¯æŒåˆ†åº“åˆ†è¡¨ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼ä¸»é”®
- **è‡ªç ”åˆ†ç‰‡ä¸­é—´ä»¶**ï¼ˆå¦‚é˜¿é‡Œ TDDLï¼‰

---

### âœ… 3. è¯»å†™åˆ†ç¦»

- ä¸»åº“ï¼ˆMasterï¼‰ï¼šå¤„ç†å†™å…¥ï¼ˆä¸‹å•ã€æ”¯ä»˜ï¼‰
- ä»åº“ï¼ˆSlaveï¼‰ï¼šå¤šä¸ªåªè¯»å‰¯æœ¬ï¼Œå¤„ç†æŸ¥è¯¢ï¼ˆè®¢å•åˆ—è¡¨ã€å•†å“è¯¦æƒ…ï¼‰
- ä½¿ç”¨ **MySQL ä¸»ä»å¤åˆ¶ + GTID** ä¿è¯ä¸€è‡´æ€§
- ä¸­é—´ä»¶è‡ªåŠ¨è·¯ç”±è¯»å†™ï¼ˆShardingSphereï¼‰

> âš ï¸ æ³¨æ„ï¼šä¸»ä»å»¶è¿Ÿ â†’ æŸ¥è¯¢å¯èƒ½è¯»åˆ°æ—§æ•°æ® â†’ ä¸šåŠ¡å®¹å¿æœ€ç»ˆä¸€è‡´æ€§

---

### âœ… 4. ç´¢å¼•ä¼˜åŒ–

```sql
-- è®¢å•è¡¨å…³é”®ç´¢å¼•
CREATE INDEX idx_user_time ON t_order(user_id, create_time DESC);
CREATE UNIQUE INDEX uk_order_no ON t_order(order_no);
CREATE INDEX idx_status_time ON t_order(status, create_time DESC);
```

> âœ… é¿å… SELECT *ï¼ŒåªæŸ¥å¿…è¦å­—æ®µ

---

### âœ… 5. å†·çƒ­åˆ†ç¦»ä¸å½’æ¡£

- **çƒ­æ•°æ®**ï¼šæœ€è¿‘ 6 ä¸ªæœˆè®¢å• â†’ åœ¨çº¿ MySQL
- **å†·æ•°æ®**ï¼š6 ä¸ªæœˆå‰ â†’ å½’æ¡£åˆ° **HBase / Tidb / Hive**
- æä¾›â€œå†å²è®¢å•â€åŠŸèƒ½ï¼Œæ”¯æŒè·¨å¹´æŸ¥è¯¢

---

## äº”ã€å…¸å‹é«˜å¹¶å‘åœºæ™¯è®¾è®¡ï¼ˆä»¥â€œç§’æ€â€ä¸ºä¾‹ï¼‰

### åœºæ™¯éœ€æ±‚ï¼š
- ç¬æ—¶ç™¾ä¸‡è¯·æ±‚æŠ¢è´­ 1000 ä»¶å•†å“
- è¦æ±‚ï¼šä¸è¶…å–ã€é«˜æ€§èƒ½ã€å¯ç”¨

### è®¾è®¡æ–¹æ¡ˆï¼š

1. **å‰ç½®æ‹¦æˆª**ï¼š
   - ç½‘å…³å±‚é™æµï¼ˆå¦‚ 10ä¸‡ QPSï¼‰
   - ç”¨æˆ·èº«ä»½æ ¡éªŒï¼ˆç™»å½•æ€ + éªŒè¯ç ï¼‰

2. **ç¼“å­˜é¢„çƒ­**ï¼š
   - å•†å“ä¿¡æ¯ã€åº“å­˜æå‰åŠ è½½åˆ° Redis

3. **åº“å­˜æ‰£å‡**ï¼š
   - Redis åŸå­æ“ä½œ `DECR` æ‰£åº“å­˜
   - è¶…å–åˆ™ç›´æ¥è¿”å›â€œå·²å”®ç½„â€

4. **å¼‚æ­¥ä¸‹å•**ï¼š
   - æ‰£åº“å­˜æˆåŠŸ â†’ å‘é€ MQ æ¶ˆæ¯ â†’ è®¢å•æœåŠ¡å¼‚æ­¥åˆ›å»ºè®¢å•
   - ç”¨æˆ·çœ‹åˆ°â€œæ’é˜Ÿä¸­â€ï¼Œæå‡ä½“éªŒ

5. **æ•°æ®åº“æŒä¹…åŒ–**ï¼š
   - MQ æ¶ˆè´¹è€…å°†è®¢å•å†™å…¥åˆ†åº“åˆ†è¡¨çš„ `t_order`

6. **é˜²åˆ·æœºåˆ¶**ï¼š
   - åŒä¸€ç”¨æˆ·é™è´­1ä»¶
   - IP/è®¾å¤‡æŒ‡çº¹é™æµ

> âœ… æ¶æ„å›¾ç®€è¿°ï¼š
```
ç”¨æˆ· â†’ ç½‘å…³ï¼ˆé™æµï¼‰â†’ Redisï¼ˆæ‰£åº“å­˜ï¼‰â†’ MQ â†’ è®¢å•æœåŠ¡ï¼ˆå¼‚æ­¥è½åº“ï¼‰
```

---

## å…­ã€é«˜å¯ç”¨ä¿éšœä½“ç³»

| å±‚çº§ | æªæ–½ |
|------|------|
| **æ¥å…¥å±‚** | Nginx + Keepalived é«˜å¯ç”¨ï¼ŒLVS è´Ÿè½½å‡è¡¡ |
| **æœåŠ¡å±‚** | æ— çŠ¶æ€è®¾è®¡ï¼ŒK8s è‡ªåŠ¨æ‰©ç¼©å®¹ |
| **ç¼“å­˜å±‚** | Redis Cluster + å“¨å…µ |
| **æ•°æ®åº“å±‚** | MySQL MHA + åˆ†åº“åˆ†è¡¨ |
| **æ¶ˆæ¯å±‚** | RocketMQ å¤šå‰¯æœ¬ + ä¸»ä»åˆ‡æ¢ |
| **å®¹ç¾** | å¤šæœºæˆ¿éƒ¨ç½²ï¼ˆåŒåŸåŒæ´» + å¼‚åœ°å®¹ç¾ï¼‰ |
| **ç›‘æ§** | Prometheus + ELK + SkyWalking å…¨é“¾è·¯è¿½è¸ª |

---

## ä¸ƒã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

| ä¼˜åŒ–ç‚¹ | æªæ–½ |
|--------|------|
| **è¿æ¥æ± ** | ä½¿ç”¨ HikariCPï¼Œåˆç†è®¾ç½®æœ€å¤§è¿æ¥æ•° |
| **SQL ä¼˜åŒ–** | é¿å… SELECT *, åˆç†å»ºç´¢å¼•ï¼Œæ…¢æŸ¥è¯¢æ—¥å¿—ç›‘æ§ |
| **æ‰¹é‡æ“ä½œ** | æ‰¹é‡æ’å…¥ç”¨ `INSERT INTO ... VALUES(...),(...)` |
| **è¿æ¥å¤ç”¨** | HTTP Keep-Aliveï¼Œå‡å°‘å»ºè¿å¼€é”€ |
| **é™æµé™çº§** | Sentinel é™æµï¼Œå¼‚å¸¸æ—¶é™çº§ä¸ºé™æ€é¡µ |
| **CDN åŠ é€Ÿ** | é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€JSï¼‰èµ° CDN |

---

## å…«ã€æ€»ç»“ï¼šç”µå•†ç³»ç»Ÿ 3H æ¶æ„å…¨æ™¯å›¾

```
+---------------------+
|     å®¢æˆ·ç«¯ï¼ˆApp/PCï¼‰   |
+----------+----------+
           |
           v
+---------------------+     +---------------------+
|   Nginx / LVS       |     |   é™æµ / é‰´æƒ / è·¯ç”±    |
+----------+----------+     +----------+----------+
           |                           |
           v                           v
+---------------------------------------------------------+
|                å¾®æœåŠ¡é›†ç¾¤ï¼ˆSpring Cloud / Dubboï¼‰         |
|  User  Product  Order  Inventory  Payment  Promotion     |
+---------------------------------------------------------+
           |        |        |         |          |
           v        v        v         v          v
+---------------------------------------------------------+
|                   æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆRocketMQ / Kafkaï¼‰           |
|                   å¼‚æ­¥è§£è€¦ã€å‰Šå³°ã€å¹¿æ’­ã€æœ€ç»ˆä¸€è‡´æ€§             |
+---------------------------------------------------------+
           |
           v
+---------------------------------------------------------+
|                   MySQL é›†ç¾¤ï¼ˆåˆ†åº“åˆ†è¡¨ + è¯»å†™åˆ†ç¦»ï¼‰         |
|   db_order_0~63   db_product   db_inventory   db_user     |
+---------------------------------------------------------+

+---------------------------------------------------------+
|                   é«˜å¯ç”¨ä¸ç›‘æ§ä½“ç³»                           |
|   Redis Cluster, MHA, Sentinel, å¤šæœºæˆ¿, Prometheus      |
+---------------------------------------------------------+
```

---

## ä¹ã€ç»“è®ºä¸å»ºè®®

| ç›®æ ‡ | å®ç°æ–¹å¼ |
|------|----------|
| **é«˜å¹¶å‘** | å¾®æœåŠ¡ + ç¼“å­˜ + æ¶ˆæ¯é˜Ÿåˆ— + åˆ†åº“åˆ†è¡¨ |
| **é«˜æ€§èƒ½** | Redis åŠ é€Ÿ + å¼‚æ­¥å¤„ç† + CDN + åˆ†ç‰‡ |
| **é«˜å¯ç”¨** | å¤šå‰¯æœ¬ + æ•…éšœè½¬ç§» + é™æµé™çº§ + å¤šæœºæˆ¿å®¹ç¾ |

âœ… **æœ€ä½³å®è·µå»ºè®®**ï¼š
1. **æ ¸å¿ƒé“¾è·¯ä¼˜å…ˆä¿éšœ**ï¼šä¸‹å•ã€æ”¯ä»˜ã€åº“å­˜å¿…é¡»é«˜å¯ç”¨
2. **ç¼“å­˜ä¸ºç‹**ï¼š90% çš„è¯»è¯·æ±‚åº”åœ¨ç¼“å­˜ä¸­è§£å†³
3. **å¼‚æ­¥åŒ–è®¾è®¡**ï¼šéæ ¸å¿ƒæ“ä½œèµ° MQ
4. ä½¿ç”¨ **ShardingSphere** ç®¡ç†åˆ†åº“åˆ†è¡¨
5. å»ºç«‹ **å…¨é“¾è·¯å‹æµ‹** æœºåˆ¶ï¼Œæ¨¡æ‹Ÿå¤§ä¿ƒæµé‡

> ğŸ”š **æœ€ç»ˆç›®æ ‡**ï¼šæ„å»ºä¸€ä¸ªæ”¯æŒ **åƒä¸‡çº§ç”¨æˆ·ã€ç™¾ä¸‡çº§ QPSã€99.99% å¯ç”¨æ€§** çš„ç°ä»£åŒ–ç”µå•†ç³»ç»Ÿï¼Œå…·å¤‡åº”å¯¹â€œåŒ11â€çº§åˆ«å¤§ä¿ƒçš„èƒ½åŠ›ã€‚




# ä¸€ã€(ç²—è¯»)å¦‚ä½•æ‹†åˆ†è®¾è®¡å¾®æœåŠ¡ã€è®¾è®¡ç¼“å­˜ã€è®¾è®¡æ¶ˆæ¯ä¸­é—´ä»¶ã€è®¾è®¡mysqlæ•°æ®åº“ï¼Œæ»¡è¶³é«˜å¹¶å‘ã€é«˜æ€§èƒ½ã€é«˜å¯ç”¨ï¼›ä»¥ç”µå•†ç³»ç»Ÿä¸ºä¾‹

# ç”µå•†ç³»ç»Ÿé«˜å¹¶å‘å…¨æ ˆæ¶æ„è®¾è®¡æŒ‡å—

## ä¸€ã€å¾®æœåŠ¡ç²¾ç»†åŒ–æ‹†åˆ†ï¼ˆç”µå•†åœºæ™¯ï¼‰

### 1. é¢†åŸŸæ¨¡å‹åˆ’åˆ†

```mermaid
graph TD
    A[ç”µå•†ç³»ç»Ÿ] --> B[å•†å“ä¸­å¿ƒ]
    A --> C[äº¤æ˜“ä¸­å¿ƒ]
    A --> D[æ”¯ä»˜ä¸­å¿ƒ]
    A --> E[ä¼šå‘˜ä¸­å¿ƒ]
    A --> F[åº“å­˜ä¸­å¿ƒ]
    A --> G[è¥é”€ä¸­å¿ƒ]
    A --> H[ç‰©æµä¸­å¿ƒ]
    A --> I[è¯„ä»·ä¸­å¿ƒ]
```

### 2. æœåŠ¡åˆ†å±‚è®¾è®¡

| å±‚çº§ | æœåŠ¡ç¤ºä¾‹ | ç‰¹ç‚¹ | æ‰©å±•ç­–ç•¥ |
|------|---------|------|---------|
| åŸºç¡€æœåŠ¡ | å•†å“/ä¼šå‘˜ | ç¨³å®š | é›†ç¾¤éƒ¨ç½² |
| æ ¸å¿ƒäº¤æ˜“ | è®¢å•/æ”¯ä»˜ | å…³é”® | å¤šæ´»éƒ¨ç½² |
| è¿è¥æœåŠ¡ | è¥é”€/CRM | å¤šå˜ | å¼¹æ€§æ‰©ç¼© |
| æ•°æ®æœåŠ¡ | æ¨è/åˆ†æ | è®¡ç®—å¯†é›† | GPUèŠ‚ç‚¹ |

### 3. å…³é”®æ‹†åˆ†åŸåˆ™
- **è®¢å•æœåŠ¡**ï¼š
  - æ‹†åˆ†ä¸ºæ­£å‘è®¢å•ï¼ˆåˆ›å»º/æ”¯ä»˜ï¼‰å’Œé€†å‘è®¢å•ï¼ˆé€€è´§/é€€æ¬¾ï¼‰
  - ä½¿ç”¨ä¸åŒæ•°æ®åº“å®ä¾‹éš”ç¦»
- **å•†å“æœåŠ¡**ï¼š
  - åˆ†ç¦»å•†å“åŸºç¡€ä¿¡æ¯ï¼ˆä½é¢‘å˜æ›´ï¼‰å’Œå•†å“å®æ—¶æ•°æ®ï¼ˆåº“å­˜/ä»·æ ¼ï¼‰
- **åº“å­˜æœåŠ¡**ï¼š
  - å•ç‹¬éƒ¨ç½²é˜²æ­¢é›ªå´©
  - é‡‡ç”¨é¢„æ‰£å‡+æœ€ç»ˆä¸€è‡´æ–¹æ¡ˆ

## äºŒã€ç¼“å­˜ä½“ç³»æ·±åº¦ä¼˜åŒ–

### 1. å¤šçº§ç¼“å­˜æ¶æ„

```mermaid
graph LR
    A[å®¢æˆ·ç«¯] --> B[CDN]
    A --> C[HTTP APIç¼“å­˜]
    D[æœåŠ¡å±‚] --> E[Redisé›†ç¾¤]
    E --> F[æœ¬åœ°ç¼“å­˜]
    F --> G[æ•°æ®åº“]
```

### 2. Redisè¯¦ç»†è®¾è®¡

#### 2.1 ä¸šåŠ¡åˆ†ç‰‡æ–¹æ¡ˆ
```plaintext
ç¼“å­˜é›†ç¾¤1ï¼ˆ16èŠ‚ç‚¹ï¼‰ï¼š
  - å•†å“ä¿¡æ¯_cache
  - ç±»ç›®æ ‘_cache
  
ç¼“å­˜é›†ç¾¤2ï¼ˆ8èŠ‚ç‚¹ï¼‰ï¼š
  - åº“å­˜é¢„æ‰£_cache
  - ç§’æ€åº“å­˜_cache
  
ç¼“å­˜é›†ç¾¤3ï¼ˆ4èŠ‚ç‚¹ï¼‰ï¼š
  - ç”¨æˆ·_session
  - è´­ç‰©è½¦_data
```

#### 2.2 çƒ­ç‚¹ç¼“å­˜è§£å†³æ–¹æ¡ˆ
```java
// çƒ­ç‚¹å•†å“ç¼“å­˜æ–¹æ¡ˆ
public Product getProduct(Long id) {
    // å¸ƒéš†è¿‡æ»¤å™¨é¢„æ£€
    if (!bloomFilter.mightContain(id)) {
        return null;
    }
    
    // æœ¬åœ°ç¼“å­˜ï¼ˆ1ç§’è¿‡æœŸï¼‰
    Product product = caffeineCache.get(id);
    if (product == null) {
        // Redisé›†ç¾¤è®¿é—®ï¼ˆå¸¦éšæœºè¿‡æœŸæ—¶é—´ï¼‰
        product = redis.get(productKey(id));
        if (product == null) {
            // æ•°æ®åº“æŸ¥è¯¢+ç¼“å­˜é‡å»º
            product = db.get(id);
            redis.setex(productKey(id), 60 + random(30), product);
        }
        caffeineCache.put(id, product, 1, TimeUnit.SECONDS);
    }
    return product;
}
```

## ä¸‰ã€æ¶ˆæ¯ä¸­é—´ä»¶è®¾è®¡

### 1. æ¶ˆæ¯æ‹“æ‰‘è®¾è®¡

```plaintext
[è®¢å•åˆ›å»º] â†’ [è®¢å•Topic] â†’ [æ”¯ä»˜ç³»ç»Ÿ]
                          â†’ [åº“å­˜ç³»ç»Ÿ]
                          â†’ [ç‰©æµç³»ç»Ÿ]
                          â†’ [æ•°æ®åˆ†æ]

[ç”¨æˆ·è¡Œä¸º] â†’ [æ—¥å¿—Topic] â†’ [å®æ—¶æ¨è]
                        â†’ [é£æ§ç³»ç»Ÿ]
```

### 2. RocketMQæœ€ä½³å®è·µ

#### 2.1 æ¶ˆæ¯åˆ†ç±»é…ç½®
| æ¶ˆæ¯ç±»å‹ | é…ç½® | ç‰¹æ€§ |
|---------|------|------|
| è®¢å•æ¶ˆæ¯ | åŒæ­¥åˆ·ç›˜ | é›¶ä¸¢å¤± |
| æ—¥å¿—æ¶ˆæ¯ | å¼‚æ­¥åˆ·ç›˜ | é«˜åå |
| ç§’æ€æ¶ˆæ¯ | å†…å­˜æ¨¡å¼ | ä½å»¶è¿Ÿ |

#### 2.2 æ¶ˆè´¹è€…ç»„è®¾è®¡
```java
// è®¢å•æ¶ˆè´¹è€…ç¤ºä¾‹
consumer.subscribe("order_topic", "*", new MessageListenerOrderly() {
    @Override
    public ConsumeOrderlyStatus consume(List<MessageExt> msgs, ConsumeOrderlyContext context) {
        // ä¿è¯ç›¸åŒè®¢å•å·é¡ºåºå¤„ç†
        processOrders(msgs);
        return ConsumeOrderlyStatus.SUCCESS;
    }
});

// åº“å­˜æ¶ˆè´¹è€…ï¼ˆæ‰¹é‡æ¨¡å¼ï¼‰
consumer.subscribe("inventory_topic", "*", new MessageListenerConcurrently() {
    @Override
    public ConsumeConcurrentlyStatus consume(List<MessageExt> msgs, ConsumeConcurrentlyContext context) {
        batchUpdateStock(msgs); // æ‰¹é‡å¤„ç†
        return ConsumeConcurrentlyStatus.CONSUME_SUCCESS;
    }
});
```

## å››ã€MySQLé«˜å¯ç”¨æ¶æ„

### 1. åˆ†åº“åˆ†è¡¨ç­–ç•¥

#### 1.1 è®¢å•åº“æ‹†åˆ†æ–¹æ¡ˆ
```sql
-- åŸå§‹è®¢å•è¡¨
CREATE TABLE orders (
    order_id VARCHAR(32),
    user_id BIGINT,
    seller_id BIGINT,
    amount DECIMAL(10,2),
    created_time DATETIME
);

-- æ‹†åˆ†ç­–ç•¥ï¼ˆ64åº“Ã—16è¡¨ï¼‰
-- åˆ†åº“é”®ï¼šuser_id % 64
-- åˆ†è¡¨é”®ï¼šFLOOR(UNIX_TIMESTAMP(created_time)/2592000) % 16 
-- ï¼ˆæŒ‰æœˆåˆ†è¡¨ï¼Œ2592000=30å¤©ç§’æ•°ï¼‰
```

#### 1.2 å…¨å±€IDç”Ÿæˆæ–¹æ¡ˆ
```java
// é›ªèŠ±ç®—æ³•æ”¹è¿›ç‰ˆ
public class SnowflakeIdGenerator {
    private final long datacenterId;  // æ•°æ®ä¸­å¿ƒID
    private final long workerId;      // æœºå™¨ID
    private long sequence = 0L;
    private long lastTimestamp = -1L;
    
    public synchronized long nextId() {
        long timestamp = timeGen();
        if (timestamp < lastTimestamp) {
            throw new RuntimeException("æ—¶é’Ÿå›æ‹¨å¼‚å¸¸");
        }
        
        if (lastTimestamp == timestamp) {
            sequence = (sequence + 1) & SEQUENCE_MASK;
            if (sequence == 0) {
                timestamp = tilNextMillis(lastTimestamp);
            }
        } else {
            sequence = 0L;
        }
        
        lastTimestamp = timestamp;
        
        return ((timestamp - TWEPOCH) << TIMESTAMP_SHIFT)
            | (datacenterId << DATACENTER_SHIFT)
            | (workerId << WORKER_SHIFT)
            | sequence;
    }
}
```

### 2. ä¸»ä»æ¶æ„ä¼˜åŒ–

```plaintext
[ä¸»åº“é›†ç¾¤]
  â”œâ”€ å†™ç»„1ï¼ˆè®¢å•åº“ï¼‰â†’ [ä»åº“] â†’ [ä»åº“]ï¼ˆè·¨æœºæˆ¿ï¼‰
  â”œâ”€ å†™ç»„2ï¼ˆå•†å“åº“ï¼‰â†’ [ä»åº“] 
  â””â”€ å†™ç»„3ï¼ˆæ”¯ä»˜åº“ï¼‰â†’ [ä»åº“] â†’ [ç¾å¤‡åº“]

[æµé‡è°ƒåº¦]
  â”œâ”€ Atlasè¯»å†™åˆ†ç¦»
  â”œâ”€ æ•…éšœè‡ªåŠ¨åˆ‡æ¢
  â””â”€ ç§’çº§ç›‘æ§æ¢æµ‹
```

## äº”ã€é«˜å¹¶å‘åœºæ™¯è§£å†³æ–¹æ¡ˆ

### 1. ç§’æ€ç³»ç»Ÿè®¾è®¡

#### 1.1 å¤šçº§åº“å­˜ä¿æŠ¤
```plaintext
[å‰ç«¯] â†’ é™æ€åŒ–+ç­”é¢˜ â†’ 
[ç½‘å…³] â†’ ä»¤ç‰Œæ¡¶é™æµ â†’ 
[Redis] â†’ é¢„å‡åº“å­˜ â†’ 
[MQ] â†’ é˜Ÿåˆ—å‰Šå³° â†’ 
[MySQL] â†’ æœ€ç»ˆæ‰£å‡
```

#### 1.2 æ ¸å¿ƒä»£ç ç¤ºä¾‹
```java
// Redisåº“å­˜é¢„å‡ï¼ˆLuaè„šæœ¬ï¼‰
String script =
    "local stock = tonumber(redis.call('get', KEYS[1])) " +
    "if stock > 0 then " +
    "   redis.call('decr', KEYS[1]) " +
    "   return 1 " +
    "end " +
    "return 0";

Long result = redisTemplate.execute(
    new DefaultRedisScript<>(script, Long.class),
    Collections.singletonList("seckill:stock:" + itemId));
```

### 2. åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ

#### 2.1 è®¢å•åˆ›å»ºæµç¨‹
```mermaid
sequenceDiagram
    participant O as è®¢å•æœåŠ¡
    participant P as æ”¯ä»˜æœåŠ¡
    participant S as åº“å­˜æœåŠ¡
    
    O->>O: åˆ›å»ºè®¢å•ï¼ˆçŠ¶æ€=å¾…æ”¯ä»˜ï¼‰
    O->>S: é¢„å åº“å­˜ï¼ˆTCCå°è¯•ï¼‰
    S-->>O: é¢„å æˆåŠŸ
    O->>P: åˆ›å»ºæ”¯ä»˜å•ï¼ˆå¼‚æ­¥ï¼‰
    P-->>O: æ”¯ä»˜æˆåŠŸå›è°ƒ
    O->>O: è®¢å•çŠ¶æ€=å·²æ”¯ä»˜
    O->>S: ç¡®è®¤åº“å­˜æ‰£é™¤ï¼ˆTCCç¡®è®¤ï¼‰
```

## å…­ã€å®¹ç¾ä¸ç›‘æ§ä½“ç³»

### 1. å¤šæ´»æ•°æ®ä¸­å¿ƒ

```plaintext
[ä¸Šæµ·ä¸­å¿ƒ]                   [åŒ—äº¬ä¸­å¿ƒ]
  â”œâ”€ å…¨é‡ä¸šåŠ¡éƒ¨ç½²               â”œâ”€ å…¨é‡ä¸šåŠ¡éƒ¨ç½²
  â”œâ”€ æ•°æ®åŒå‘åŒæ­¥               â””â”€ æµé‡éšæ—¶åˆ‡æ¢
  â””â”€ 70%æ—¥å¸¸æµé‡
  
[åŒæ­¥å±‚]
  â”œâ”€ Canalå®ç°MySQLå¢é‡åŒæ­¥
  â”œâ”€ Redis CRDTæ•°æ®ç»“æ„
  â””â†’ 200mså†…æ•°æ®ä¸€è‡´æ€§
```

### 2. ç›‘æ§å¤§ç›˜è®¾è®¡

#### 2.1 æ ¸å¿ƒæŒ‡æ ‡
- **æ•°æ®åº“å±‚**ï¼š
  - ä¸»ä»å»¶è¿Ÿ
  - æ…¢æŸ¥è¯¢æ¯”ä¾‹
  - QPS/TPSæ³¢åŠ¨
  
- **æœåŠ¡å±‚**ï¼š
  - æ¥å£æˆåŠŸç‡
  - å¹³å‡/99çº¿å»¶è¿Ÿ
  - çº¿ç¨‹æ± çŠ¶æ€

#### 2.2 æŠ¥è­¦è§„åˆ™ç¤ºä¾‹
```yaml
# Prometheus Alert Rules
- alert: HighDatabaseLatency
  expr: mysql_global_status_seconds_behind_master > 5
  for: 2m
  labels:
    severity: critical
  annotations:
    summary: "æ•°æ®åº“ä¸»ä»å»¶è¿Ÿè¿‡é«˜ ({{ $value }}ç§’)"
    
- alert: OrderServiceError
  expr: rate(order_service_errors_total[1m]) > 10
  for: 5m
  labels:
    severity: warning
```
