å¥½çš„ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†è§£æä»¥å¤ªåŠåˆçº¦ä¸­ `view` å’Œ `pure` å‡½æ•°çš„åŒºåˆ«ï¼Œè¿™æ˜¯ç†è§£Gasä¼˜åŒ–å’Œå‡½æ•°è¡Œä¸ºçš„å…³é”®ã€‚

## æ ¸å¿ƒåŒºåˆ«æ€»ç»“

| ç‰¹æ€§ | `view` å‡½æ•° | `pure` å‡½æ•° | æ™®é€šå‡½æ•° |
| :--- | :--- | :--- | :--- |
| **è¯»å–çŠ¶æ€** | âœ… å¯ä»¥ | âŒ ä¸å¯ä»¥ | âœ… å¯ä»¥ |
| **ä¿®æ”¹çŠ¶æ€** | âŒ ä¸å¯ä»¥ | âŒ ä¸å¯ä»¥ | âœ… å¯ä»¥ |
| **Gasæˆæœ¬** | å…è´¹ï¼ˆæœ¬åœ°è°ƒç”¨ï¼‰ | å…è´¹ï¼ˆæœ¬åœ°è°ƒç”¨ï¼‰ | éœ€è¦Gas |
| **è°ƒç”¨æ–¹å¼** | æœ¬åœ°æ‰§è¡Œ | æœ¬åœ°æ‰§è¡Œ | ä¸Šé“¾äº¤æ˜“ |

---

## è¯¦ç»†è§£æ

### 1. `view` å‡½æ•° - åªè¯»ä¸å†™

**å®šä¹‰**ï¼šå¯ä»¥è¯»å–åˆçº¦çŠ¶æ€ï¼Œä½†**ä¸èƒ½ä¿®æ”¹**ä»»ä½•çŠ¶æ€ã€‚

```solidity
contract ViewExample {
    uint256 public totalSupply;
    mapping(address => uint256) public balances;
    
    // âœ… viewå‡½æ•° - å¯ä»¥è¯»å–çŠ¶æ€
    function getBalance(address account) public view returns (uint256) {
        return balances[account]; // è¯»å–æ˜ å°„
    }
    
    function calculatePercentage(uint256 percentage) public view returns (uint256) {
        return (totalSupply * percentage) / 100; // è¯»å–çŠ¶æ€å˜é‡å¹¶è®¡ç®—
    }
    
    function getBlockNumber() public view returns (uint256) {
        return block.number; // è¯»å–åŒºå—é“¾ä¿¡æ¯
    }
    
    // âŒ è¿™äº›æ“ä½œåœ¨viewå‡½æ•°ä¸­ä¸å…è®¸ï¼š
    function invalidView() public view {
        // totalSupply = 100;          // é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹çŠ¶æ€
        // balances[msg.sender] = 100; // é”™è¯¯ï¼šä¸èƒ½ä¿®æ”¹çŠ¶æ€  
        // emit Transfer(...);         // é”™è¯¯ï¼šä¸èƒ½è§¦å‘äº‹ä»¶
    }
}
```

### 2. `pure` å‡½æ•° - çº¯è®¡ç®—

**å®šä¹‰**ï¼š**ä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½ä¿®æ”¹**ä»»ä½•çŠ¶æ€ï¼Œåªèƒ½ä½¿ç”¨ä¼ å…¥çš„å‚æ•°å’Œå±€éƒ¨å˜é‡è¿›è¡Œè®¡ç®—ã€‚

```solidity
contract PureExample {
    // âœ… pureå‡½æ•° - åªè¿›è¡Œè®¡ç®—ï¼Œä¸æ¥è§¦çŠ¶æ€
    function add(uint256 a, uint256 b) public pure returns (uint256) {
        return a + b; // ä»…ä½¿ç”¨å‚æ•°
    }
    
    function multiply(uint256 a, uint256 b) public pure returns (uint256) {
        return a * b;
    }
    
    function keccak256Hash(string memory input) public pure returns (bytes32) {
        return keccak256(abi.encodePacked(input)); // å“ˆå¸Œè®¡ç®—æ˜¯çº¯æ“ä½œ
    }
    
    // âŒ è¿™äº›æ“ä½œåœ¨pureå‡½æ•°ä¸­ä¸å…è®¸ï¼š
    function invalidPure() public pure returns (uint256) {
        // return totalSupply;          // é”™è¯¯ï¼šä¸èƒ½è¯»å–çŠ¶æ€å˜é‡
        // return balances[msg.sender]; // é”™è¯¯ï¼šä¸èƒ½è¯»å–æ˜ å°„
        // return block.timestamp;      // é”™è¯¯ï¼šä¸èƒ½è¯»å–åŒºå—é“¾ä¿¡æ¯
        // return msg.sender;           // é”™è¯¯ï¼šä¸èƒ½è¯»å–äº¤æ˜“ä¸Šä¸‹æ–‡
    }
}
```

---

## å®é™…è°ƒç”¨ç¤ºä¾‹

### åœ¨Solidityåˆçº¦ä¸­è°ƒç”¨

```solidity
contract Caller {
    ViewExample viewContract;
    PureExample pureContract;
    
    function demonstrateCalls() public {
        // âœ… è°ƒç”¨viewå‡½æ•° - åœ¨é“¾ä¸Šäº¤æ˜“ä¸­ä»ç„¶éœ€è¦Gas
        uint256 balance = viewContract.getBalance(msg.sender);
        
        // âœ… è°ƒç”¨pureå‡½æ•° - åœ¨é“¾ä¸Šäº¤æ˜“ä¸­éœ€è¦Gas  
        uint256 result = pureContract.add(10, 20);
        
        // åœ¨åˆçº¦å†…éƒ¨è°ƒç”¨æ—¶ï¼Œview/pureå‡½æ•°åœ¨äº¤æ˜“ä¸­æ‰§è¡Œï¼Œéœ€è¦Gas
    }
    
    function localPureCall() public pure returns (uint256) {
        // âœ… åœ¨pureå‡½æ•°å†…è°ƒç”¨å¦ä¸€ä¸ªpureå‡½æ•°
        return add(5, 10); // è¿™æ²¡é—®é¢˜
    }
    
    function localViewCall() public view returns (uint256) {
        // âœ… åœ¨viewå‡½æ•°å†…è°ƒç”¨pureå‡½æ•°
        uint256 calc = add(1, 2); // è¿™æ²¡é—®é¢˜
        return calc;
    }
}
```

### åœ¨Web3.js / Ethers.jsä¸­è°ƒç”¨

```javascript
// ä½¿ç”¨ Web3.js
const Web3 = require('web3');
const web3 = new Web3('https://mainnet.infura.io/v3/YOUR_PROJECT_ID');

const contractAddress = '0x...';
const abi = [/* åˆçº¦ABI */];
const contract = new web3.eth.Contract(abi, contractAddress);

// âœ… è°ƒç”¨viewå‡½æ•° - å…è´¹ï¼Œæœ¬åœ°æ‰§è¡Œ
const balance = await contract.methods.getBalance('0x123...').call();

// âœ… è°ƒç”¨pureå‡½æ•° - å…è´¹ï¼Œæœ¬åœ°æ‰§è¡Œ  
const result = await contract.methods.add(10, 20).call();

// âŒ è¿™äº›ä¸èƒ½é€šè¿‡call()è°ƒç”¨
// await contract.methods.transfer(...).call(); // ä½†è¯­æ³•å…è®¸ï¼Œç»“æœä¸å¯é 
```

```javascript
// ä½¿ç”¨ Ethers.js
const { ethers } = require('ethers');

const provider = new ethers.providers.JsonRpcProvider('RPC_URL');
const contract = new ethers.Contract(contractAddress, abi, provider);

// âœ… è°ƒç”¨view/pureå‡½æ•°
const balance = await contract.getBalance('0x123...');
const result = await contract.add(10, 20);
```

---

## Gasæˆæœ¬åˆ†æ

### ä¸åŒåœºæ™¯ä¸‹çš„Gasæ¶ˆè€—

```solidity
contract GasAnalysis {
    uint256 public stateVariable = 100;
    
    // ğŸ”´ çŠ¶æ€ä¿®æ”¹å‡½æ•° - éœ€è¦Gas
    function setValue(uint256 newValue) public {
        stateVariable = newValue; // å†™å…¥å­˜å‚¨ â†’ æ¶ˆè€—Gas
    }
    
    // ğŸŸ¢ viewå‡½æ•° - å¤–éƒ¨è°ƒç”¨å…è´¹ï¼Œå†…éƒ¨è°ƒç”¨éœ€è¦Gas
    function getValue() public view returns (uint256) {
        return stateVariable; // è¯»å–å­˜å‚¨
    }
    
    // ğŸŸ¢ pureå‡½æ•° - å¤–éƒ¨è°ƒç”¨å…è´¹ï¼Œå†…éƒ¨è°ƒç”¨éœ€è¦Gas  
    function compute(uint256 a, uint256 b) public pure returns (uint256) {
        return a * b + a / b; // çº¯è®¡ç®—
    }
    
    function testInternalCalls() public {
        // åœ¨äº¤æ˜“ä¸­è°ƒç”¨viewå‡½æ•° â†’ éœ€è¦Gas
        uint256 value = getValue(); // æ¶ˆè€—Gasï¼Œå› ä¸ºè¿™æ˜¯äº¤æ˜“çš„ä¸€éƒ¨åˆ†
        
        // åœ¨äº¤æ˜“ä¸­è°ƒç”¨pureå‡½æ•° â†’ éœ€è¦Gas
        uint256 result = compute(10, 2); // æ¶ˆè€—Gasï¼Œå› ä¸ºè¿™æ˜¯äº¤æ˜“çš„ä¸€éƒ¨åˆ†
    }
}
```

**å…³é”®ç†è§£**ï¼š
- **å¤–éƒ¨è°ƒç”¨**ï¼ˆé€šè¿‡call()ï¼‰ï¼š`view`/`pure` å‡½æ•°åœ¨èŠ‚ç‚¹æœ¬åœ°æ‰§è¡Œï¼Œå…è´¹
- **å†…éƒ¨è°ƒç”¨**ï¼ˆåœ¨äº¤æ˜“ä¸­ï¼‰ï¼š`view`/`pure` å‡½æ•°ä½œä¸ºäº¤æ˜“çš„ä¸€éƒ¨åˆ†æ‰§è¡Œï¼Œéœ€è¦Gas

---

## ç¼–è¯‘å™¨éªŒè¯å’Œé”™è¯¯

Solidityç¼–è¯‘å™¨ä¼šä¸¥æ ¼æ£€æŸ¥è¿™äº›ä¿®é¥°ç¬¦ï¼š

```solidity
contract CompilerChecks {
    uint256 public data;
    
    // âŒ ç¼–è¯‘é”™è¯¯ï¼šå‡½æ•°å£°æ˜ä¸ºpureï¼Œä½†è¯»å–äº†çŠ¶æ€å˜é‡
    function invalidPure() public pure returns (uint256) {
        return data; // Error: Function declared as pure, but this expression reads from state
    }
    
    // âŒ ç¼–è¯‘é”™è¯¯ï¼šå‡½æ•°å£°æ˜ä¸ºviewï¼Œä½†ä¿®æ”¹äº†çŠ¶æ€
    function invalidView() public view {
        data = 100; // Error: Function declared as view, but this expression modifies state
    }
    
    // âœ… æ­£ç¡®ï¼šè¯»å–çŠ¶æ€ä½†ä¸ä¿®æ”¹
    function validView() public view returns (uint256) {
        return data * 2;
    }
    
    // âœ… æ­£ç¡®ï¼šçº¯è®¡ç®—
    function validPure(uint256 a, uint256 b) public pure returns (uint256) {
        return a + b;
    }
}
```

---

## æœ€ä½³å®è·µå’Œå¸¸è§æ¨¡å¼

### 1. æ˜ç¡®å‡½æ•°æ„å›¾
```solidity
contract BestPractices {
    mapping(address => uint256) private _balances;
    
    // âœ… å¥½çš„å®è·µï¼šæ˜ç¡®å£°æ˜åªè¯»å‡½æ•°ä¸ºview
    function balanceOf(address account) public view returns (uint256) {
        return _balances[account];
    }
    
    // âœ… å¥½çš„å®è·µï¼šå·¥å…·å‡½æ•°å£°æ˜ä¸ºpure
    function calculateReward(uint256 principal, uint256 rate) public pure returns (uint256) {
        return principal * rate / 10000;
    }
    
    // âŒ ä¸å¥½çš„å®è·µï¼šåº”è¯¥å£°æ˜ä¸ºviewä½†æ²¡å£°æ˜
    function getBalance(address account) public returns (uint256) {
        return _balances[account]; // ç¼–è¯‘å™¨ä¼šè­¦å‘Šï¼
    }
}
```

### 2. å¤æ‚çš„viewå‡½æ•°
```solidity
contract ComplexView {
    struct User {
        uint256 balance;
        uint256 lastActivity;
        bool isActive;
    }
    
    mapping(address => User) private users;
    
    // viewå‡½æ•°å¯ä»¥æ‰§è¡Œå¤æ‚é€»è¾‘ï¼Œåªè¦ä¸ä¿®æ”¹çŠ¶æ€
    function getUserStats(address user) public view returns (
        uint256 balance,
        uint256 daysSinceActivity,
        bool eligibleForReward
    ) {
        User storage userData = users[user];
        balance = userData.balance;
        
        // å¤æ‚è®¡ç®—ï¼Œä½†ä¸ä¿®æ”¹çŠ¶æ€
        daysSinceActivity = (block.timestamp - userData.lastActivity) / 1 days;
        eligibleForReward = userData.isActive && balance > 1000 ether;
    }
}
```

### 3. åº“åˆçº¦ä¸­çš„pureå‡½æ•°
```solidity
library Math {
    // å·¥å…·å‡½æ•°é€šå¸¸åº”è¯¥æ˜¯pure
    function max(uint256 a, uint256 b) internal pure returns (uint256) {
        return a > b ? a : b;
    }
    
    function min(uint256 a, uint256 b) internal pure returns (uint256) {
        return a < b ? a : b;
    }
    
    function sqrt(uint256 x) internal pure returns (uint256 y) {
        // å¹³æ–¹æ ¹ç®—æ³• - çº¯è®¡ç®—
        uint256 z = (x + 1) / 2;
        y = x;
        while (z < y) {
            y = z;
            z = (x / z + z) / 2;
        }
    }
}
```

---

## ç‰¹æ®Šæƒ…å†µè¯´æ˜

### 1. åœ°å€ç›¸å…³æ“ä½œ
```solidity
contract AddressOperations {
    // âŒ è¿™ä¸æ˜¯pureï¼Œå› ä¸ºaddress(this)è¯»å–äº†åˆçº¦çŠ¶æ€
    function getThisAddress() public pure returns (address) {
        // return address(this); // é”™è¯¯ï¼è¿™ä¸æ˜¯çº¯å‡½æ•°
    }
    
    // âœ… è¿™æ˜¯viewï¼Œå› ä¸ºè¯»å–äº†åˆçº¦è‡ªèº«åœ°å€
    function getThisAddress() public view returns (address) {
        return address(this); // æ­£ç¡®
    }
}
```

### 2. å†…ç½®å‡½æ•°åˆ†ç±»
```solidity
contract BuiltinFunctions {
    function testFunctions() public view returns (bytes memory) {
        // âœ… è¿™äº›åœ¨viewå‡½æ•°ä¸­å…è®¸ï¼š
        address(this).balance;    // view
        block.timestamp;          // view  
        msg.sender;               // view
        
        // âœ… è¿™äº›åœ¨pureå‡½æ•°ä¸­å…è®¸ï¼š
        // keccak256(abi.encodePacked("hello"));  // pure
        // uint256.max;                          // pure
        
        return abi.encode("data"); // view
    }
}
```

## æ€»ç»“

**å…³é”®è¦ç‚¹ï¼š**

1. **`view`å‡½æ•°**ï¼š
   - å¯ä»¥è¯»å–çŠ¶æ€å˜é‡ã€æ˜ å°„ã€æ•°ç»„ç­‰
   - å¯ä»¥è¯»å–åŒºå—é“¾ä¿¡æ¯ï¼ˆblock.timestamp, msg.senderç­‰ï¼‰
   - ä¸èƒ½ä¿®æ”¹ä»»ä½•çŠ¶æ€
   - å¤–éƒ¨è°ƒç”¨å…è´¹ï¼Œå†…éƒ¨è°ƒç”¨æ¶ˆè€—Gas

2. **`pure`å‡½æ•°**ï¼š
   - ä¸èƒ½è¯»å–ä»»ä½•çŠ¶æ€
   - åªèƒ½ä½¿ç”¨å‡½æ•°å‚æ•°å’Œå±€éƒ¨å˜é‡
   - è¿›è¡Œçº¯æ•°å­¦è®¡ç®—
   - å¤–éƒ¨è°ƒç”¨å…è´¹ï¼Œå†…éƒ¨è°ƒç”¨æ¶ˆè€—Gas

3. **ä½¿ç”¨åœºæ™¯**ï¼š
   - æ•°æ®æŸ¥è¯¢ â†’ `view`
   - å·¥å…·è®¡ç®— â†’ `pure` 
   - çŠ¶æ€ä¿®æ”¹ â†’ ä¸åŠ ä¿®é¥°ç¬¦

**æœ€ä½³å®è·µ**ï¼š
- æ€»æ˜¯ä¸ºåªè¯»å‡½æ•°æ·»åŠ æ­£ç¡®çš„ä¿®é¥°ç¬¦
- è¿™æ—¢èŠ‚çœç”¨æˆ·Gasï¼Œåˆè®©ä»£ç æ„å›¾æ›´æ¸…æ™°
- è®©ç¼–è¯‘å™¨å¸®ä½ æ•è·æ½œåœ¨çš„é”™è¯¯

ç†è§£è¿™ä¸ªåŒºåˆ«å¯¹äºç¼–å†™é«˜æ•ˆã€å®‰å…¨çš„æ™ºèƒ½åˆçº¦è‡³å…³é‡è¦ï¼
