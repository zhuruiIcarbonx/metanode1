本课程概述了两个高级去中心化金融 (DeFi) 概念：最大杠杆和闪电杠杆。虽然本课程并未深入探讨这两个主题，但在 Cyfrin Updraft 课程“Rocket Pool rETH 集成”中，尤其是在题为“Aave 闪电杠杆”的第三部分中，对它们进行了详细的介绍。在本课程中，我们将探讨这两个概念的基本机制、关键公式以及一个示例。

了解 DeFi 中的最大杠杆
DeFi 中的最大杠杆是指通过反复循环存入抵押品、以抵押品借入资金、用借入的资金获得更多抵押品，然后重新存入新的抵押品，从而最大化你对某项资产的敞口的策略。这个过程有效地放大了多头杠杆头寸（押注抵押品价格上涨），尽管这些原则也可以适用于空头头寸。

循环机制

通过循环实现最大杠杆的核心涉及以下迭代步骤：

存入抵押品：首先将初始金额的抵押品存入借贷协议。

借款：以您存入的抵押品借入资产（例如，美元等稳定币），最高可达允许的贷款价值比 (LTV)。

购买更多抵押品：使用借入的资金购买更多相同的抵押资产。

重复：将新获得的抵押品存回借贷协议（步骤 1）并重复借贷和购买的循环。

数学推导和关键公式

为了理解这种循环策略的局限性，让我们定义一些变量并推导出最大可实现杠杆的公式。

变量：

c= 初始抵押品金额

p= 抵押品的美元价格

L= 贷款价值比 (LTV)。这是抵押品价值中可供借入的部分（例如，如果 LTV 为 80%，L = 0.8）。

循环的一次迭代：

借入金额（美元）：（ L * c * p
您借入的L金额乘以您当前抵押品的美元价值c）。

购买的抵押品：（ (L * c * p) / p = L * c
借入的美元用于购买更多抵押品；价格p抵消，将新抵押品的数量简化为L * c）。

存入新的抵押品：（ L * c
此新购买的抵押品将添加到协议中您现有的抵押品中）。

总抵押品（最大抵押品）：
重复此循环，存入的总抵押品将形成一个几何级数：
Total Collateral = c + Lc + L²c + L³c + ...
可以分解为： ，设，则
Total Collateral = c * (1 + L + L² + L³ + ...)
无限几何级数之和为。由于 LTV 始终小于 100%（即），因此该条件成立。 因此，您可以累积的最大抵押品为：(1 + L + L² + L³ + ...)1 / (1 - L)|L| < 1L < 1

Max Collateral <= c * (1 / (1 - L))

最大杠杆公式：
杠杆是您的总有效抵押品（或敞口）与初始抵押品的比率。
Max Leverage = (Total Collateral) / (Initial Collateral)
Max Leverage = [c * (1 / (1 - L))] / c
这简化为最大杠杆的关键公式：

最大杠杆=  1  / ( 1  - L)
最大杠杆示例：

假设L您在借贷协议中所选抵押品的贷款价值比 ( ) 为 0.8（即 80%）。
使用以下公式：
Max Leverage = 1 / (1 - 0.8) = 1 / 0.2 = 5
这意味着，在 80% 的贷款价值比 (LTV) 下，您可以通过此循环策略，在初始抵押品上实现最高 5 倍的杠杆。

探索闪电杠杆：即时杠杆仓位
闪电杠杆提供了一种利用闪电贷实现杠杆头寸的替代方法，通常只需一笔原子区块链交易即可完成。这种方法避免了最大杠杆循环过程中固有的多次手动交易。

使用闪电杠杆开仓的流程

使用闪电贷开立杠杆头寸的典型步骤通常涉及用户、Uniswap 等去中心化交易所（DEX）（用于获取闪电贷或交换资产）以及 Aave 等借贷协议，如下所示：

初始抵押品：用户从初始抵押品金额开始（我们称之为c0）。

申请闪电贷：用户从 Uniswap 或 Aave 等提供商处申请特定金额的资产（例如美元）的闪电贷。此类贷款无需抵押，但必须在同一笔交易中偿还。

购买抵押品：用户立即使用闪电贷出的美元在 DEX 上购买更多所需的抵押资产。

存入所有抵押品：用户将其初始抵押品（c0）加上新获得的抵押品（用闪电贷购买）存入借贷协议（例如 Aave）。

按总抵押品借款：用户根据借贷协议，按现在更大的抵押品总额借入美元。

偿还闪电贷款：用户使用从借贷协议借入的美元偿还原始闪电贷款（加上任何费用）。

所有这些步骤都必须在一次原子交易中成功执行；如果任何步骤失败，整个序列都会被撤销，并且闪电贷款实际上永远不会发放。

Flash 杠杆的关键数学见解

确定最佳闪电贷金额及其杠杆的精确计算可能非常复杂。“Rocket Pool rETH 集成”课程将详细介绍这些内容。以下是一些关键的关系和公式：

与借入金额（B）、总抵押品（C）、闪电贷金额（F）、初始抵押品（c0）和杠杆系数（k）相关的条件：
B/C = F / ((k+1)c0) = (k c0) / ((k+1)c0) = k / (k+1) <= L
这里，表示您的初始抵押品乘以闪电贷k多少倍才能购买更多抵押品。c0

杠杆系数k与 LTV 相关（L）：
k <= L / (1-L)

闪电贷金额（F），也可以被认为是交换或购买的抵押品金额（c_s）：
F = c_s = k * c_0 <= (L / (1-L)) * c_0

闪电杠杆可实现的最大抵押品与无限循环方法的结果相匹配：
Max Collateral = (1 / (1-L)) * c_0
这也可以表示为闪电贷获得的抵押品与初始抵押品的总和：
Max Collateral = (L / (1-L)) * c_0 + c_0

这些公式可以进行有效执行闪电杠杆策略所需的精确计算，只需一步即可实现所需（或最大）杠杆。

实现高级杠杆的关键 DeFi 原语
最大杠杆和闪电杠杆策略都建立在几个基本的 DeFi 概念之上：

杠杆：总体目标，允许用户扩大其对资产价格变动的敞口，使其超出其初始资本。

抵押品：用于担保贷款的资产。在这些策略中，抵押品数量会主动增加。

贷款价值比 (LTV)：贷款协议设定的一个关键参数 ( L)。它决定了在给定抵押品金额的情况下可以借入的最高金额，并直接影响可实现的最大杠杆率。较高的 LTV 允许更高的杠杆率。

超额抵押贷款： DeFi 借贷（例如 Aave、Compound）的标准模型，其中存入的抵押品价值必须超过贷款价值。最大杠杆循环策略系统地运用了这种模型。

闪电贷：在同一区块链交易中借入和偿还的无抵押贷款。它们是闪电杠杆策略的基石，无需预先投入资金即可获得大量抵押品。

几何级数：推导公式的关键数学概念1 / (1 - L)，它量化了通过循环方法可实现的最大杠杆。

原子交易：一系列操作，要么全部成功，要么全部失败，如果任何部分失败，则恢复到初始状态。闪电贷和闪电杠杆策略高度依赖原子性，以确保在后续步骤执行时，闪电贷始终能够得到偿还。

了解这些高级杠杆技术，有助于深入了解 DeFi 中复杂的资本效率策略。有关详细的推导、实际实现和代码示例，请参阅 Cyfrin Updraft 上“Rocket Pool rETH 集成”课程的第三部分“Aave 闪电杠杆”。
